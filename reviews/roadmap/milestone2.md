# Milestone 2: 에디터 UX 개선

## 목표
긴 프롬프트(7000자+)를 편하게 작성할 수 있는 에디터 환경 제공

## 문제 인식
- **현재**: 720px 고정 너비 = 화면 넓어도 답답함
- **사용자**: example.md(200줄) 같은 긴 프롬프트 작성 시 스크롤 지옥
- **핵심**: 저장 기능 없어도 됨 (example.md 외부 관리) → 편집 경험이 우선

---

## Phase 1: 반응형 기본 크기 (즉시 개선)

### 목표
화면 크기에 따라 에디터가 자동으로 적절한 크기로 표시

### 작업
- [ ] 너비: `min(85vw, 1400px)` (기존: 720px)
  - 작은 화면: 85% 활용
  - 큰 화면: 최대 1400px로 제한
- [ ] 높이: `minHeight: 360px`, `maxHeight: 85vh` (기존: 고정)
  - **minHeight**: 작은 창에서도 최소 크기 유지
  - **maxHeight**: 작은 화면에서 잘림 방지
- [ ] 내부 textarea: `height: calc(85vh - [헤더 + 푸터 높이])`
  - 헤더/푸터 제외한 실제 편집 영역 계산
  - 예: `calc(85vh - 100px)` (헤더 44px + 푸터 56px)

### UX 체크포인트
- [ ] 1920×1080 화면에서 답답하지 않은지
- [ ] 1366×768 화면에서 잘리지 않는지
- [ ] 세로로 긴 모바일 화면 대응 (선택)

### 예상 시간
30분 ~ 1시간

---

## Phase 2: 사용자 크기 조절 + 저장

### 목표
사용자가 원하는 크기로 조절 후, 다음에도 같은 크기로 열림

### 작업

#### 2-1. Resize Handle 구현
- [ ] 우하단 코너에 resize handle 추가
  - 시각적 표시: `◢` 아이콘 or 작은 삼각형
  - cursor: `nwse-resize`
- [ ] 마우스 드래그로 너비/높이 조절
  - `mousedown` → `mousemove` → `mouseup` 이벤트
  - 실시간 크기 업데이트

#### 2-2. 크기 제한 (Guard Rails)
- [ ] 최소 크기 설정
  - 너비: `480px` (프롬프트 읽기 최소 너비)
  - 높이: `320px` (버튼 등 UI 요소 표시 최소)
- [ ] 최대 크기 설정
  - 너비: `min(1600px, 95vw)` (너무 커지지 않도록)
  - 높이: `95vh` (화면 거의 전체)
- [ ] 뷰포트 밖으로 나가지 않도록 제한
  ```javascript
  const maxWidth = window.innerWidth - 32; // 좌우 여백 16px씩
  const maxHeight = window.innerHeight - 32;
  ```

#### 2-3. Tampermonkey 권한 추가
- [ ] **메타데이터에 @grant 추가** (필수)
  ```javascript
  // @grant GM_setValue
  // @grant GM_getValue
  ```
  - 권한 미설정 시 런타임 에러 발생

#### 2-4. 크기 및 위치 저장
- [ ] `GM_setValue` 사용
  ```javascript
  GM_setValue('gpi_editorState', {
    width: 1200,
    height: 800,
    top: 100,   // 위치도 함께 저장
    left: 300
  });
  ```
- [ ] 다음 오픈 시 `GM_getValue`로 복원
- [ ] 저장된 값 검증
  - 최소/최대 범위 체크
  - **위치가 화면 밖이면 기본 위치로 리셋** (fallback)
  - 잘못된 값이면 기본값 사용

#### 2-5. textarea 내부 크기 동기화
- [ ] 에디터 크기 변경 시 textarea도 함께 조절
  ```javascript
  textarea.style.height = `calc(${editorHeight}px - 100px)`;
  ```
- [ ] 포커스 유지 (사용자가 입력 중이라면)

### UX 체크포인트
- [ ] 드래그 중 버벅임 없이 부드러운지
- [ ] 크기 조절 후 저장되는지 확인
- [ ] 페이지 새로고침 후 복원되는지
- [ ] 너무 작거나 큰 값 입력 시 안전하게 처리되는지

### 예상 시간
2 ~ 3시간

---

## Phase 3: 전체화면 모드

### 목표
원클릭으로 몰입 환경 제공 (전체 화면 ↔ 일반 모드)

### 작업

#### 3-1. 전체화면 버튼 추가
- [ ] 헤더의 닫기(X) 버튼 옆에 `⛶` 아이콘 추가
  - 위치: 제목과 닫기 버튼 사이
  - 툴팁: "전체화면 (ESC로 종료)"
- [ ] 버튼 스타일
  - 기본: 반투명
  - hover: 밝게
  - 전체화면 상태: 하이라이트 (배경색 변경 등)

#### 3-2. 전체화면 토글 로직
- [ ] 클릭 시 전체화면 ON
  ```javascript
  // 현재 크기/위치 저장 (복원용)
  state.beforeFullscreen = {
    width: editor.style.width,
    height: editor.style.height,
    top: editor.style.top,
    left: editor.style.left,
    transform: editor.style.transform
  };

  // 전체화면 적용
  editor.style.width = '100vw';
  editor.style.height = '100vh';
  editor.style.top = '0';
  editor.style.left = '0';
  editor.style.transform = 'none';
  ```
- [ ] 다시 클릭 시 전체화면 OFF (복원 순서 중요)
  1. **저장된 사용자 크기 복원**: `GM_getValue('gpi_editorState')`
  2. **위치 복원**: `state.beforeFullscreen` 또는 저장된 위치
  3. **transform 복원**: 드래그 이동 반영
  4. **화면 밖 체크**: 위치가 뷰포트 밖이면 중앙으로
- [ ] 상태 저장 (선택)
  - 전체화면 상태를 기억할지 여부 (논의 필요)

#### 3-3. 종료 방법 다양화
- [ ] ESC 키 누름 → 전체화면 해제
- [ ] 닫기(X) 버튼 클릭 → 에디터 닫기 (전체화면도 해제)
- [ ] 취소 버튼 클릭 → 에디터 닫기 (전체화면도 해제)
- [ ] 적용 버튼 클릭 → 프롬프트 적용 + 에디터 닫기

#### 3-4. 시각적 피드백
- [ ] 전체화면 ON 시
  - 버튼 아이콘 변경: `⛶` → `⛶` (색상 강조)
  - 또는 아이콘 교체: `⛶` → `⛝` (축소)
- [ ] 전체화면 OFF 시
  - 원래 아이콘으로 복원

### UX 체크포인트
- [ ] 전체화면 전환이 부드러운지
- [ ] ESC, X, 취소, 적용 모두 예상대로 동작하는지
- [ ] 전체화면 상태가 시각적으로 명확한지
- [ ] 전체화면에서 드래그 비활성화 (필요 시)

### 예상 시간
1 ~ 2시간

---

## Phase 4: 포커스 흐름 재점검

### 목표
크기 변경/전체화면 전환 시에도 매끄러운 입력 경험 유지

### 작업
- [ ] 에디터 오픈 시 textarea 자동 포커스
  - 기존: `requestAnimationFrame` 사용
  - 확인: Phase 1~3 적용 후에도 정상 작동하는지
- [ ] 크기 조절 중 포커스 유지
  - 사용자가 입력 중이라면 포커스 잃지 않도록
- [ ] 전체화면 전환 시 포커스 복원
  ```javascript
  window.requestAnimationFrame(() => {
    textarea.focus();
    textarea.setSelectionRange(
      textarea.value.length,
      textarea.value.length
    );
  });
  ```
- [ ] Tab 키 동작 결정 (둘 중 선택)
  - **옵션 A**: 에디터 내부에서만 Tab 순환 (focus trap)
    - textarea → 취소 → 적용 → textarea 반복
    - 접근성 좋음, 키보드 전용 사용자 편함
  - **옵션 B**: 브라우저 기본 흐름 유지
    - Tab으로 Genit 페이지로 벗어날 수 있음
    - 자연스러움, 구현 간단
  - **추천**: 옵션 B (일단 기본 동작 유지, 필요시 M3에서 추가)

### UX 체크포인트
- [ ] 팝업 열자마자 타이핑 가능한지
- [ ] 크기 조절해도 입력 내용 보존되는지
- [ ] 전체화면 전환 후 커서 위치 유지되는지

### 예상 시간
30분 ~ 1시간

---

## 기술 스택

### 필수
- **Vanilla JavaScript**: resize, fullscreen 로직
- **Tampermonkey GM API**:
  - `GM_setValue`: 크기 저장
  - `GM_getValue`: 크기 복원

### 고려사항
- CSS `resize` 속성 대신 커스텀 구현 (더 정확한 제어)
- 드래그 중 `user-select: none` 적용 (텍스트 선택 방지)
- 전체화면 시 애니메이션 (선택, 200ms transition 정도)

---

## 완료 조건

- [ ] **Phase 1**: 1920×1080, 1366×768 화면에서 적절한 크기 확인
- [ ] **Phase 2**: 크기 조절 후 새로고침해도 복원됨
- [ ] **Phase 3**: 전체화면 모드 ON/OFF 부드럽게 작동
- [ ] **Phase 4**: 모든 상황에서 textarea 포커스 정상 작동
- [ ] **전체**: example.md(200줄) 스크롤 없이 편집 가능

---

## 테스트 시나리오

### 시나리오 1: 반응형 크기
1. 1920×1080 화면에서 에디터 오픈 → 넓은 편집 공간 확인
2. 브라우저 창 줄이기 (1366×768) → 에디터 크기 자동 조정 확인
3. 매우 작은 창 (1024×600) → 잘리지 않고 스크롤 생성 확인

### 시나리오 2: 크기 조절
1. 에디터 우하단 핸들 드래그 → 크기 변경
2. "적용" 클릭 → 에디터 닫기
3. 다시 프롬프트 창 클릭 → 이전 크기로 열림 확인

### 시나리오 3: 전체화면
1. 전체화면 버튼(`⛶`) 클릭 → 100vw×100vh 확인
2. ESC 누름 → 원래 크기로 복원
3. 다시 전체화면 → X 버튼 클릭 → 에디터 닫기

### 시나리오 4: 포커스
1. 에디터 열자마자 타이핑 → 즉시 입력됨
2. 크기 조절 중 입력 → 포커스 유지 확인
3. 전체화면 전환 → 커서 위치 그대로 확인

---

## 다음 마일스톤 (M3) 후보

- 프롬프트 프리셋 저장/관리 (localStorage)
- 문법 하이라이팅
- 변수 치환 시스템 (`{{변수명}}`)
- Import/Export 기능

---

**작성일**: 2025-10-04
**피드백 반영**: Codex의 UX 개선 제안
